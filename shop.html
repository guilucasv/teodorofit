<!doctype html>
<html lang="pt-br">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="author" content="Untree.co">
	<link rel="shortcut icon" href="favicon.png">

	<meta name="description" content="Loja Teodoro Fitness" />
	<meta name="keywords" content="fitness, roupas, loja" />

	<!-- Bootstrap CSS -->
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
	<link href="css/tiny-slider.css" rel="stylesheet">
	<link href="css/style.css" rel="stylesheet">
	<title>Teodoro Fitness - Loja</title>
	<style>
		.product-item {
			background: white;
			padding: 20px;
			border-radius: 8px;
			transition: all 0.3s ease;
			height: 100%;
			display: flex;
			flex-direction: column;
		}

		.product-item:hover {
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
			transform: translateY(-5px);
		}

		.product-thumbnail {
			width: 100%;
			height: 200px;
			object-fit: cover;
			margin-bottom: 15px;
			border-radius: 6px;
		}

		.product-title {
			font-size: 16px;
			font-weight: 600;
			color: #1a1a1a;
			margin-bottom: 10px;
			min-height: 40px;
		}

		.product-price {
			font-size: 18px;
			color: #ef5734;
			font-weight: 700;
			margin-bottom: 15px;
		}

		.product-item .btn {
			margin-top: auto;
		}
	</style>
</head>

<body>

	<!-- Start Header/Navigation -->
	<nav class="custom-navbar navbar navbar navbar-expand-md navbar-dark bg-dark" arial-label="Furni navigation bar">

		<div class="container">
			<a class="navbar-brand" href="index.html">
				<img src="images/logo.png" alt="Teodoro Fitness" class="logo-img">
			</a>

			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsFurni"
				aria-controls="navbarsFurni" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>

			<div class="collapse navbar-collapse" id="navbarsFurni">
				<ul class="custom-navbar-nav navbar-nav ms-auto mb-2 mb-md-0">
					<li class="nav-item">
						<a class="nav-link" href="index.html">Home</a>
					</li>
					<li class="active"><a class="nav-link" href="shop.html">Loja</a></li>
					<li><a class="nav-link" href="contact.html">Contatos</a></li>
				</ul>

				<ul class="custom-navbar-cta navbar-nav mb-2 mb-md-0 ms-5">
					<li class="navbar-cta"><a class="nav-link" href="cart.html" style="position: relative;">
							<img src="images/cart.svg" alt="Carrinho">
							<span id="cart-badge"
								style="display: none; position: absolute; top: -8px; right: -8px; background-color: #ef5734; color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold;"></span>
						</a></li>
				</ul>
			</div>
		</div>

	</nav>
	<!-- End Header/Navigation -->

	<!-- Start Hero Section -->
	<div class="hero">
		<div class="container">
			<div class="row justify-content-between">
				<div class="col-lg-5">
					<div class="intro-excerpt">
						<h1>Loja</h1>
					</div>
				</div>
				<div class="col-lg-7">

				</div>
			</div>
		</div>
	</div>
	<!-- End Hero Section -->

	<div class="untree_co-section product-section before-footer-section">
		<div class="container">
			<!-- Filtros / Ordena√ß√£o (Opcional, futuro) -->

			<!-- Grid de Produtos Din√¢mico -->
			<div class="row" id="shop-products-container">
				<div class="col-12 text-center">
					<p>Carregando cat√°logo...</p>
				</div>
			</div>
		</div>
	</div>

	<script>
		document.addEventListener('DOMContentLoaded', () => {
			fetch('/api/products')
				.then(res => res.json())
				.then(products => {
					const container = document.getElementById('shop-products-container');

					if (products.length === 0) {
						container.innerHTML = '<div class="col-12 text-center"><h3>Nenhum produto dispon√≠vel no momento.</h3></div>';
						return;
					}

					container.innerHTML = products.map(p => {
						const priceFormatted = parseFloat(p.price).toFixed(2);
						// Verifica estoque
						const qty = parseInt(p.quantity) || 0;
						const isOutOfStock = qty <= 0;
						let stockLabel = '';

						const unitLabel = qty === 1 ? 'unidade' : 'unidades';

						if (isOutOfStock) {
							stockLabel = '<span class="badge bg-danger mb-2">Esgotado</span>';
						} else if (qty <= 5) {
							stockLabel = `<span class="badge bg-warning text-dark mb-2">üî• Restam apenas ${qty} ${unitLabel}!</span>`;
						} else {
							stockLabel = `<span class="badge bg-success mb-2">Em estoque: ${qty} ${unitLabel}</span>`;
						}

						const btnDisabled = isOutOfStock ? 'disabled style="opacity:0.5; cursor:not-allowed;"' : '';
						const btnText = isOutOfStock ? 'Indispon√≠vel' : '<i class="fa fa-shopping-cart"></i> Carrinho';

						// Using data attributes instead of inline onclick to prevent quote escaping issues
						const dataAttrs = isOutOfStock ? '' : `
                            data-id="${p.id}" 
                            data-title="${p.title}" 
                            data-price="R$ ${priceFormatted}" 
                            data-image="${p.image}"
                            class="btn btn-black btn-sm w-100 js-add-to-cart"
                        `;

						// If out of stock, use standard class
						const btnClass = isOutOfStock ? 'class="btn btn-black btn-sm w-100"' : '';

						return `
                        <div class="col-12 col-md-4 col-lg-3 mb-5">
                            <div class="product-item">
                                <img src="${p.image}" class="img-fluid product-thumbnail" alt="${p.title}">
                                <h3 class="product-title">${p.title}</h3>
                                ${stockLabel}
                                <strong class="product-price">R$ ${priceFormatted}</strong>
                                
                                <p style="font-size:12px; color:#666; margin-bottom:10px;">
                                    ${p.description || ''}
                                </p>

                                <button ${isOutOfStock ? btnClass : dataAttrs} ${btnDisabled}>
                                    ${btnText}
                                </button>
                            </div>
                        </div>
                        `;
					}).join('');
				})
				.catch(err => {
					console.error(err);
					document.getElementById('shop-products-container').innerHTML = '<div class="col-12 text-center text-danger">Erro ao carregar produtos.</div>';
				});
		});


		// Event Delegation for Dynamic Cart Buttons
		document.addEventListener('click', function (e) {
			const button = e.target.closest('.js-add-to-cart');

			if (button) {
				e.preventDefault();
				const id = button.dataset.id;
				const title = button.dataset.title;
				const price = button.dataset.price;
				const image = button.dataset.image;

				console.log('Button Clicked:', { id, title, price });

				if (typeof addToCart === 'function') {
					addToCart(id, title, price, image);
				} else {
					console.error('addToCart function missing!');
					alert('Erro interno: fun√ß√£o de carrinho n√£o encontrada.');
				}
			}
		});
	</script>

	<script src="js/bootstrap.bundle.min.js"></script>
	<script src="js/tiny-slider.js"></script>
	<script src="js/custom.js"></script>
	<script src="js/cart.js"></script>
</body>

</html>