<!doctype html>
<html lang="pt-br">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="author" content="Untree.co">
	<link rel="shortcut icon" href="favicon.png">

	<meta name="description" content="Loja Teodoro Fitness" />
	<meta name="keywords" content="fitness, roupas, loja" />

	<!-- Bootstrap CSS -->
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
	<link href="css/tiny-slider.css" rel="stylesheet">
	<link href="css/style.css" rel="stylesheet">
	<title>Teodoro Fitness - Loja</title>
	<style>
		.product-item {
			background: white;
			padding: 20px;
			border-radius: 8px;
			transition: all 0.3s ease;
			height: 100%;
			display: flex;
			flex-direction: column;
		}

		.product-item:hover {
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
			transform: translateY(-5px);
		}

		.product-thumbnail {
			width: 100%;
			height: 250px;
			display: none;
			/* Hidden by default for slider */
			object-fit: contain;
			/* Prevents cropping */
			background-color: #f8f9fa;
			/* Light gray bg for images with transparency */
			margin-bottom: 15px;
			border-radius: 6px;
		}

		.product-thumbnail.active {
			display: block;
			/* Show active slide */
		}

		.product-slider {
			position: relative;
			width: 100%;
			height: 250px;
			margin-bottom: 15px;
		}

		.slider-slides {
			width: 100%;
			height: 100%;
			overflow: hidden;
			border-radius: 6px;
		}

		.slider-btn {
			position: absolute;
			top: 50%;
			transform: translateY(-50%);
			background: rgba(0, 0, 0, 0.3);
			color: white;
			border: none;
			width: 30px;
			height: 30px;
			border-radius: 50%;
			cursor: pointer;
			z-index: 10;
			display: flex;
			align-items: center;
			justify-content: center;
			transition: background 0.3s;
		}

		.slider-btn:hover {
			background: rgba(0, 0, 0, 0.6);
		}

		.slider-btn.prev {
			left: 5px;
		}

		.slider-btn.next {
			right: 5px;
		}

		.product-title {
			font-size: 16px;
			font-weight: 600;
			color: #1a1a1a;
			margin-bottom: 10px;
			min-height: 40px;
		}

		.product-price {
			font-size: 18px;
			color: #ef5734;
			font-weight: 700;
			margin-bottom: 15px;
		}

		.product-item .btn {
			margin-top: auto;
		}
	</style>
</head>

<body>

	<!-- Start Header/Navigation -->
	<nav class="custom-navbar navbar navbar navbar-expand-md navbar-dark bg-dark" arial-label="Furni navigation bar">

		<div class="container">
			<a class="navbar-brand" href="index.html">
				<img src="images/logo.png" alt="Teodoro Fitness" class="logo-img">
			</a>

			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsFurni"
				aria-controls="navbarsFurni" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>

			<div class="collapse navbar-collapse" id="navbarsFurni">
				<ul class="custom-navbar-nav navbar-nav ms-auto mb-2 mb-md-0">
					<li class="nav-item">
						<a class="nav-link" href="index.html">Home</a>
					</li>
					<li class="active"><a class="nav-link" href="shop.html">Loja</a></li>
					<li><a class="nav-link" href="contact.html">Contatos</a></li>
				</ul>

				<ul class="custom-navbar-cta navbar-nav mb-2 mb-md-0 ms-5">
					<li class="navbar-cta"><a class="nav-link" href="cart.html" style="position: relative;">
							<img src="images/cart.svg" alt="Carrinho">
							<span id="cart-badge"
								style="display: none; position: absolute; top: -8px; right: -8px; background-color: #ef5734; color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold;"></span>
						</a></li>
				</ul>
			</div>
		</div>

	</nav>
	<!-- End Header/Navigation -->

	<!-- Start Hero Section -->
	<div class="hero">
		<div class="container">
			<div class="row justify-content-between">
				<div class="col-lg-5">
					<div class="intro-excerpt">
						<h1>Loja</h1>
					</div>
				</div>
				<div class="col-lg-7">

				</div>
			</div>
		</div>
	</div>
	<!-- End Hero Section -->

	<div class="untree_co-section product-section before-footer-section">
		<div class="container">
			<!-- Filtros / Ordenação (Opcional, futuro) -->

			<!-- Grid de Produtos Dinâmico -->
			<div class="row" id="shop-products-container">
				<div class="col-12 text-center">
					<p>Carregando catálogo...</p>
				</div>
			</div>
		</div>
	</div>

	<script>
		// Old script logic removed in favor of integrated QuickView logic below
	</script>

	<!-- Product Quick View Modal -->
	<div class="modal fade" id="productQuickViewModal" tabindex="-1" aria-hidden="true" style="z-index: 10000;">
		<div class="modal-dialog modal-xl mt-4">
			<div class="modal-content shadow-lg rounded-3">
				<div class="modal-body p-0">
					<button type="button" class="btn-close position-absolute top-0 end-0 m-3" data-bs-dismiss="modal"
						aria-label="Close" style="z-index: 10;"></button>
					<div class="row g-0">
						<!-- Product Images (Carousel) -->
						<div class="col-lg-7 bg-light">
							<div id="productCarousel" class="carousel slide h-100" data-bs-ride="carousel">
								<div class="carousel-inner h-100" id="modal-carousel-inner">
									<!-- Slides generated by JS -->
								</div>
								<button class="carousel-control-prev" type="button" data-bs-target="#productCarousel"
									data-bs-slide="prev">
									<span class="carousel-control-prev-icon" aria-hidden="true"
										style="background-color:rgba(0,0,0,0.5); border-radius:50%;"></span>
									<span class="visually-hidden">Previous</span>
								</button>
								<button class="carousel-control-next" type="button" data-bs-target="#productCarousel"
									data-bs-slide="next">
									<span class="carousel-control-next-icon" aria-hidden="true"
										style="background-color:rgba(0,0,0,0.5); border-radius:50%;"></span>
									<span class="visually-hidden">Next</span>
								</button>
							</div>
						</div>

						<!-- Product Details -->
						<div class="col-lg-5 p-4 p-lg-5">

							<h2 class="fw-bold mb-2" id="modal-product-title">Nome do Produto</h2>
							<div class="mb-3">
								<span class="h3 text-primary fw-bold" id="modal-product-price">R$ 0,00</span>
								<div class="text-muted small mt-1">
									em até <span class="fw-bold">6x de <span id="modal-installments">R$ 0,00</span>
										sem
										juros</span>
								</div>
							</div>

							<div class="mb-4">
								<div class="d-flex justify-content-between align-items-center mb-2">
									<span class="fw-bold">Tamanho:</span>
									<span class="badge bg-dark">Único (36-42)</span>
								</div>
								<div class="text-muted small">
									Todas as nossas peças são tamanho único e se ajustam perfeitamente do 36 ao 42
									graças
									à tecnologia do tecido.
								</div>
							</div>

							<div class="mb-4">
								<label class="form-label fw-bold">Quantidade:</label>
								<div class="d-flex align-items-center">
									<button class="btn btn-dark btn-sm rounded-circle p-0" type="button"
										onclick="qvChangeQty(-1)"
										style="width: 36px; height: 36px; display:flex; align-items:center; justify-content:center; font-size: 18px;">-</button>

									<input type="text"
										class="form-control text-center mx-2 border-0 bg-transparent fw-bold"
										id="modal-qty" value="1" readonly
										style="width: 50px; height: 40px; font-size: 18px; color: #000;">

									<button class="btn btn-dark btn-sm rounded-circle p-0" type="button"
										onclick="qvChangeQty(1)"
										style="width: 36px; height: 36px; display:flex; align-items:center; justify-content:center; font-size: 18px;">+</button>
								</div>
							</div>


							<div class="d-grid gap-2">
								<button class="btn btn-primary btn-lg" id="btn-add-cart">
									Adicionar ao Carrinho
								</button>
								<button class="btn btn-success btn-lg" id="btn-buy-now">
									Comprar Agora
								</button>
							</div>

							<div class="mt-4 pt-4 border-top">
								<h6 class="fw-bold mb-3">Você também pode gostar:</h6>
								<div class="row g-2" id="related-products-container">
									<!-- Related items JS -->
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- Full Width Description (Bottom) -->
				<div class="p-4 bg-light border-top">
					<div class="container-fluid">
						<h5 class="fw-bold fs-6 mb-3 text-dark">Descrição do Produto</h5>
						<p class="text-dark small mb-0" id="modal-product-desc"
							style="line-height: 1.6; font-size: 0.95rem;">
							Descrição do produto...
						</p>
					</div>
				</div>
			</div>
		</div>
	</div>
	</div>

	<style>
		/* Quick View Styles */
		#modal-carousel-inner img {
			width: 100%;
			height: auto;
			max-height: 600px;
			object-fit: contain;
			background-color: #fff;
		}

		@media (max-width: 991px) {
			#modal-carousel-inner img {
				height: 350px;
			}
		}

		.related-item {
			cursor: pointer;
			transition: opacity 0.2s;
		}

		.related-item:hover {
			opacity: 0.8;
		}
	</style>

	<script src="js/bootstrap.bundle.min.js"></script>
	<script src="js/tiny-slider.js"></script>
	<script src="js/custom.js"></script>
	<script src="js/cart.js"></script>

	<script>
		let allProducts = [];
		let currentProduct = null;

		document.addEventListener('DOMContentLoaded', () => {
			fetch('/api/products')
				.then(res => res.json())
				.then(products => {
					allProducts = products; // Store globally
					renderGrid(products);
				})
				.catch(err => {
					console.error(err);
					document.getElementById('shop-products-container').innerHTML = '<div class="col-12 text-center text-danger">Erro ao carregar produtos.</div>';
				});
		});

		function renderGrid(products) {
			const container = document.getElementById('shop-products-container');

			if (products.length === 0) {
				container.innerHTML = '<div class="col-12 text-center"><h3>Nenhum produto disponível no momento.</h3></div>';
				return;
			}

			container.innerHTML = products.map((p, index) => {
				const priceFormatted = parseFloat(p.price).toFixed(2);
				const qty = parseInt(p.quantity) || 0;
				const isOutOfStock = qty <= 0;
				let stockLabel = '';

				if (isOutOfStock) {
					stockLabel = '<span class="badge bg-danger mb-2">Esgotado</span>';
				} else if (qty <= 5) {
					stockLabel = `<span class="badge bg-warning text-dark mb-2">Restam ${qty}</span>`;
				}

				// Generate simple card logic
				return `
					<div class="col-12 col-md-4 col-lg-3 mb-5">
						<div class="product-item" onclick="openQuickView(${index})" style="cursor: pointer;">
							<div style="position:relative; overflow:hidden; border-radius:10px; margin-bottom:15px; height:250px; background:#f8f9fa;">
								<img src="${p.image}" class="img-fluid" style="width:100%; height:100%; object-fit:contain;" alt="${p.title}">
								${stockLabel ? `<div style="position:absolute; top:10px; left:10px;">${stockLabel}</div>` : ''}
							</div>
							<h3 class="product-title">${p.title}</h3>
							<strong class="product-price">R$ ${priceFormatted}</strong>
							
							<button class="btn btn-black btn-sm w-100 mt-2">
								<i class="fa fa-eye"></i> Ver Detalhes
							</button>
						</div>
					</div>
                `;
			}).join('');
		}

		// OPEN QUICK VIEW
		window.openQuickView = function (index) {
			const product = allProducts[index];
			currentProduct = product; // Set current

			// 1. Populate Text
			document.getElementById('modal-product-title').innerText = product.title;
			document.getElementById('modal-product-price').innerText = `R$ ${parseFloat(product.price).toFixed(2)}`;
			document.getElementById('modal-product-desc').innerText = product.description || 'Sem descrição disponível.';

			// Installments (6x)
			const instValue = (parseFloat(product.price) / 6).toFixed(2);
			document.getElementById('modal-installments').innerText = `R$ ${instValue}`;

			// 2. Populate Carousel
			const carouselInner = document.getElementById('modal-carousel-inner');
			let images = (product.images && product.images.length > 0) ? product.images : [product.image];

			carouselInner.innerHTML = images.map((img, i) => `
				<div class="carousel-item ${i === 0 ? 'active' : ''}">
					<img src="${img}" class="d-block w-100" alt="${product.title}">
				</div>
			`).join('');

			// 3. Reset Qty
			document.getElementById('modal-qty').value = 1;

			// 4. Buttons Logic
			const isOutOfStock = (parseInt(product.quantity) || 0) <= 0;
			const btnAdd = document.getElementById('btn-add-cart');
			const btnBuy = document.getElementById('btn-buy-now');

			if (isOutOfStock) {
				btnAdd.disabled = true;
				btnAdd.innerText = 'Esgotado';
				btnBuy.disabled = true;
			} else {
				btnAdd.disabled = false;
				btnAdd.innerText = 'Adicionar ao Carrinho';
				btnBuy.disabled = false;

				// Attach Click Events
				btnAdd.onclick = () => {
					const qty = parseInt(document.getElementById('modal-qty').value);
					addToCart(product.id, product.title, product.price, product.image, qty);
					// Bootstrap Modal hide
					const modalEl = document.getElementById('productQuickViewModal');
					const modal = bootstrap.Modal.getInstance(modalEl);
					modal.hide();
				};

				btnBuy.onclick = () => {
					const qty = parseInt(document.getElementById('modal-qty').value);
					addToCart(product.id, product.title, product.price, product.image, qty);
					window.location.href = 'checkout.html';
				};
			}

			// 5. Related Products (Random 2 excluding current)
			const relatedContainer = document.getElementById('related-products-container');
			const otherProducts = allProducts.filter(p => p.id !== product.id);

			// Shuffle and take 2
			const shuffled = otherProducts.sort(() => 0.5 - Math.random()).slice(0, 2);

			if (shuffled.length > 0) {
				relatedContainer.innerHTML = shuffled.map(p => `
					<div class="col-6">
						<div class="d-flex align-items-center bg-white p-2 border rounded related-item" 
							 onclick="const idx = allProducts.findIndex(x => x.id === '${p.id}'); openQuickView(idx);">
							<img src="${p.image}" style="width:50px; height:50px; object-fit:cover; border-radius:5px; margin-right:10px;">
							<div>
								<div class="small fw-bold text-truncate" style="max-width:120px;">${p.title}</div>
								<div class="small text-primary">R$ ${parseFloat(p.price).toFixed(2)}</div>
							</div>
						</div>
					</div>
				`).join('');
			} else {
				relatedContainer.innerHTML = '<small class="text-muted">Sem itens relacionados.</small>';
			}

			// SHOW MODAL
			const modal = new bootstrap.Modal(document.getElementById('productQuickViewModal'));
			modal.show();
		}

		// Qty Change
		window.qvChangeQty = function (change) {
			const input = document.getElementById('modal-qty');
			let val = parseInt(input.value) + change;
			if (val < 1) val = 1;
			// Check Max Stock
			const max = parseInt(currentProduct.quantity) || 100;
			if (val > max) {
				val = max;
				alert('Quantidade máxima disponível atingida!');
			}
			input.value = val;
		}

		// Slider Navigation Logic (Mantido se precisar fora do modal, mas agora usando grid simples)
		window.moveSlider = function (btn, direction) { /* ... */ };
	</script>

</html>